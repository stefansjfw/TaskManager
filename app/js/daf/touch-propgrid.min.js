/*!
* Touch UI - Property Grid
* Copyright 2021-2024 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function y(n,i){if(c||(c=t.userVar("propCollapsed")||{}),arguments.length===2)i===null?delete c[n]:c[n]=i,t.userVar("propCollapsed",c);else return c[n]}function ft(n){var c=[],l={},r=n.properties,u,o=0,s=0,f,i,h,e;r||(r=n.properties={});for(f in r)i=r[f],i||(i=r[f]={}),i.parent=n,o++,i.name||(i.name=f),i.text||(i.text=t.prettyText(f,!0)),i.type||(i.type="text"),i.type!=="text"||"length"in i||(i.length=255),i.type==="bool"&&(i.style||(i.style="DropDownList")),i.values&&!i.style&&(i.style="DropDownList"),!i.style||"required"in i||(i.placeholder="(not set)"),i.type==="bool"&&i.style==="DropDownList"&&(i.values=dt),i.primary&&(u=i),n.visible?(i.visible=i.visible?`(${n.visible})&&(${i.visible})`:n.visible,s++):i.visible&&s++,h=i.text+"|"+f,c.push(h),l[h]=i,i.properties&&ft(i);n.parent&&o&&o===s&&(n.complexOnDemand=!0);e=r._names=[];c.sort().forEach(n=>{e.push(l[n].name)});u&&(e.splice(e.indexOf(u.name),1),u.visible!=null&&e.forEach(n=>{var t=r[n];t.visible=t.visible?`(${u.visible})&&(${t.visible})`:u.visible}),e.splice(0,0,u.name))}function ni(i){var f=i.find("[data-category]:not(.app-collapsed)"),r,u;f.length||i.find("[data-category]:first .app-toggle").trigger("vclick");i.find(".app-complex-on-demand").each(et);r=n.pageInfo().dataView;r&&(u=t.userVar(`${r._survey.context.instance}.navigate`),u?t.userVar(`${r._survey.context.instance}.navigate`,null):u=t.userVar(`${r._survey.context.instance}.${r._survey.context.propSet?._registered}.lastSelected`),u?n.propGrid.select(u):n.propGrid.info());setTimeout(ot)}function et(){var i=$(this),t,n;if(i.is(".app-complex-on-demand")){for(t=!1,n=i.next();!t&&n.length&&n.is("[data-depth]");)n.is('[data-depth="1"]')&&n[0].style.display!=="none"&&(t=!0),n=n.next();i.toggleClass("app-complex-off",!t)}}function ot(){var t=n.treeView.context(),i=[];n.activePage(".app-toolbar-nav .app-btn").each(function(){var n=$(this),r=n.attr("data-pg-action");switch(r){case"propgrid.refresh":case"propgrid.collapse-all":break;case"propgrid.properties":n.toggleClass("app-disabled",!t.node);break;case"propgrid.pin":n.toggleClass("app-disabled",!t.node);break;default:i.push(n)}});i.forEach(n=>{n.remove()})}function st(){var t=[];i("[data-layout]").data("rootNodes")[0].children.forEach(function(n){n.ready||t.push(n)});t.length&&n.layout({controls:t})}function ht(){var t=n.scrollable();t.find(".app-stub").css("height",d(t).height)}function ct(){var r=n.scrollable(),u=d(r),i=r.find(".app-stub"),f=d(i);t.intersect(u,f)?i.css("height",u.bottom-f.top+1):i.css("height","")}function p(){var i=$(this).closest("[data-property]"),s=i.data("property")+"_",r=!i.is(".app-collapsed"),h=tt(i),t=i.next(),e=[],o,u,f;for(ht(r),y(i.data("scope")+"$"+i.data("property"),r==!0?r:h.expanded===!1?!1:null),i.toggleClass("app-collapsed",r);t.length&&(t.data("property")||"").startsWith(s);)t.is(".app-collapsed")&&e.push(t.data("property")),r?t.addClass("app-collapsed-prop"):(u=t.data("property"),f=!1,e.forEach(function(n){u.startsWith(n)&&u.length>n.length&&(f=!0)}),f||t.removeClass("app-collapsed-prop")),o=t,t=t.next();return r||st(),n.hasFocus(i.find('[data-control="field"]')),ct(),r||wt(i,o),!1}function g(t,r){r!==!1&&n.scrollIntoView(t);i(".app-has-focus").removeClass("app-has-focus");t.addClass("app-has-focus");i().removeData("last-focused-field");var u=lt(t);nt(u.text,u.hint,!1)}function nt(n,t,r,u){var f=i().data("infoPane");f&&(f.scrollTop(0),f.find(".app-text").text(n||""),f.find(".app-description").html(t||""),f.find(".app-see-also").html(u||"").css("display",u?"":"none"),f.find(".app-help").css("display",r?"":"none"))}function lt(n){var t=n.closest("[data-property]"),i,r;return t.length||(t=n.closest("[data-category]")),r=t.data("scope"),i=t.data("category-name")||t.data("category"),v[r][i]}function tt(n){var i=lt(n),r=n.closest("[data-property]"),u=r.data("property")||"",t=i;return u.split(/_/).forEach(n=>t=t.properties[n]),t}function ti(){return n.dataView().data("survey")}function it(t,r,u,f,e){if(f==null&&(f=u),e==null&&(e=Math.ceil(f/2)),t.css({minWidth:u,maxWidth:u,width:u}).data("modalWidth",u),n.resetPageHeight(t),r||(r=i('[data-draggable="propgrid-divider"]')),r.length){var o=parseInt(t[0].style.minWidth),h=Math.max(Math.ceil(e*(o/f)),s());o-h<s()&&(h=o-s()-7);at(r,o,h)}}function at(n,t,i){var r=i+"px",u=t-i-7+"px";n.each(function(){this.style.left=i+"px";for(var n=this.nextSibling;n;){switch(n.getAttribute&&n.getAttribute("data-control")){case"label":n.style.maxWidth=r;n.style.minWidth=r;n.style.width=r;break;case"field":n.style.maxWidth=u;n.style.minWidth=u;n.style.width=u}n=n.nextSibling}})}function w(t,r){var o=n.treeView.context?n.treeView.context(i(".app-treeview .app-selected")):{},u={eventName:t},f,e;for(f in r)u[f]=r[f];return e=$.Event("propgrid.app",{propGrid:u,treeView:o}),$(document).trigger(e),u.infoPaneChanged&&b(i("[data-property] .app-has-focus:first")),e}function ii(){}function l(t,i){i?(t._get=yt,t._set=vt,t._tagged=ui,t._changed||(t._changed=ii),t._context=n.propGrid.data):(delete t._get,delete t._set,delete t._changed,delete t._context,delete t._tagged,delete t._tagList)}function vt(n,t){if(arguments.length!=2)throw new Error('The property setter expects the "selector" and "value" parameters.');var i=this;n=n.split(/\./g);n.forEach((r,u)=>{if(u==n.length-1)i[r]=t;else{var f=i[r];f||(f=i[r]={});i=f}})}function yt(n){if(arguments.length!=1)throw new Error('The property getter expects the "selector" parameter only.');var t=this,i=null;return n=n.split(/\./g),n.every((r,u)=>{if(u==n.length-1)i=t[r];else if(t=t[r],t!=null)return!0}),i}function a(i,r,u){try{if(arguments.length==2)return i.get?t.eval(i.get,r):i.select?yt.call(r,i.select):r[i.propName];i.set?t.eval(i.set,r,u):i.select?vt.call(r,i.select,u):r[i.propName]=u}catch(f){throw Error((arguments.length==2?`Unabled to evaluate the "getter" of the ${n.propGrid.toPropPath(i)} property: ${i.get}`:`Unabled to evaluate the "setter" of the ${n.propGrid.toPropPath(i)} property: ${i.set}`)+"\nError: "+f.message);}}function b(n){var e;if(!$(n).length){nt();return}for(var u=tt(n),i=u.parent,f=[u.text],t=[],r=u.seeAlso;i;)(i.parent||i.name!="misc")&&f.splice(0,0,i.text),i=i.parent;r&&(typeof r=="string"&&(r=[r]),e=$app.touch.dataView()._survey.context?.target||{},r.forEach(n=>{var i=$app.eval(n,e);i!=null&&(t.length||(t.push(`<b>${o.Menu.SeeAlso}</b>`),t.push("<ul>")),t.push("<li>",i,"<\/li>"))}),t.length&&t.push("<\/ul>"));nt(f.join(" / "),u.hint,!0,t.join(""))}function u(n,i,r){if(i||(i=k().instance),n=`propGrid.${i}.${n}`,arguments.length==2)return t.userVar(n);t.userVar(n,r)}function pt(){var r=i(),c,f,o,h;if(r.is(".app-propgrid")){c=t.clientRect(r);f=$(window).width()-s()*2;c.width>f&&it(r,null,f);var a=r.find(".app-wrapper"),e=t.clientRect(a),l=r.find(".app-infopane"),v=t.clientRect(l);v.top<e.bottom&&(l.css({height:"",minHeight:"",maxHeight:""}),u("infoPane.height",null,null),n.resetPageHeight());o=r.find(".app-top-nav");h=t.clientRect(o);(h.top<0||h.height>=window.innerHeight||e.bottom>window.innerHeight||e.height<rt())&&(o.css({height:"",minHeight:"",maxHeight:""}),u("topNav.height",null,null),n.resetPageHeight());n.scrollable("refresh")}}function rt(){return n.settings("ui.propGrid.minHeight")||100}function s(){return n.settings("ui.propGrid.minDividerX")||75}function ri(n,r){i().is(".app-propgrid")&&n.forEach(n=>t.eval(n.finish,r))}function wt(i,r){var o=t.clientRect(n.scrollable(r)),h=t.clientRect(r),e;if(h.bottom>o.bottom){for(var c=t.clientRect(i),s=c.height,f=i,u=i.next();u.length;){if(e=t.clientRect(u),s+=e.height,s>o.height)break;else e.height&&(f=u);if(u.is(r))break;u=u.next()}f.length&&!i.data("navigating")&&setTimeout(()=>{f[0].scrollIntoView({block:"end",behavior:"smooth"})},32)}}function k(){return n.dataView()._survey.context}function bt(n,t,i,r){var f,u,e;if(n.compound)return f=[],u=[],n.compound.forEach(t=>{var s=n.name+"_"+t,e=i[s],o=r[s];o!=null&&(e.type==="bool"?o&&f.push(e.text):f.push(o));e&&(e.type==="bool"?e.default&&u.push(e.text):e.default!=null&&u.push(e.default))}),e=f.join(", "),t&&(r[n.name]=e,t.default=n.default=u.length?u.join(", "):null),e}function ui(n,t){var i=this._tagList,r,u;return i||(i=this._tagList=fi(this.tags)),n instanceof RegExp?(i.every(t=>(r=t.match(n),r==null)),r||(r={})):(n.trim().split(/\s*,\s*/g).every(n=>{var f,e;if(arguments.length==2&&(n=(t?"+":"-")+" "+n),f=n.match(/^\s*(\+|\-)\s*(.+)$/),f)if(f[1]==="+")e=i.indexOf(f[2]),e===-1&&(i.push(f[2]),u=!0);else for(e=i.indexOf(f[2]);e>=0;)i.splice(e,1),u=!0,e=i.indexOf(f[2]);else r=i.indexOf(n)!==-1;return r==null}),u&&(this.tags=i.join(" "),this._changed("tags"))),r}function fi(n){return n==null?n=[]:typeof n=="string"&&(n=(n||"").replace(/,/g," ").split(/\s+/g)),n}var t=$app,r=t.input,n=t.touch,kt=$(document),o=Web.DataViewResources,ut=o.Data.BooleanDefaultItems,d=t.clientRect,dt=[{value:!1,text:ut[0][1]},{value:!0,text:ut[1][1]}],v={},c,gt={misc:{scope:"_unknown"}},i=n.activePage,f=t.html,ei=f.tag,oi=f.div,si=f.span,hi=f.$tag,ci=f.$p,e=f.$div,h=f.$span,li=f.$a,ai=f.$i,vi=f.$li,yi=f.$ul;n.propSet=function(n){var o,u,i,s,f,r,h,e;if(!n._registered){o="_unknown";for(u in n){if(i=n[u],o=i.scope,s=v[o],s||(s=v[o]={_names:[]}),s[u]=i,s._names.push(u),i.name||(i.name=u),i.text||(i.text=t.prettyText(u,!0)),i.visible){f=null;r=null;for(h in i.properties)e=i.properties[h],e.primary?r?delete e.primary:r=e:e.visible||f||(f=e);r?r.visible=r.visible?`(${i.visible})&&(${r.visible})`:i.visible:f&&(f.visible=i.visible,f.primary=!0)}ft(i)}n._registered=o}};n.propGrid=function(r,f){function e(){var n=arguments,u=1,t=arguments[0],r,i=[];for((n.length===1||n.length>1&&!(n[0]==="categories"||n[0]==="props"))&&(u=0,t="all"),r=u;r<n.length;r++)i.push(n[r]);i=i.join("");(t==="categories"||t==="all")&&p.push(i);(t==="props"||t==="all")&&ct.push(i)}function ht(n,i,r,u,o){var v,s={name:(r?r+"_":"")+i.name,type:i.type,text:i.text,options:i.options||{},causesCalculate:!0},h,l,c;i.propName=s.name;"spellCheck"in s.options||(s.options.spellCheck=!1);f.propMap[s.name]=i;i.compound&&(typeof i.compound=="string"&&(i.compound=i.compound.split(/\s*,\s*/g)),i.readOnly=!0,i.virtual=!0,"expanded"in i||(i.expanded=!1));i.readOnly!=null&&(i.readOnly===!0?s.readOnly=!0:s.readOnlyWhen=i.readOnly);i.required&&(s.required=!0);i.mode&&(s.mode=i.mode);i.style&&(s.items={style:i.style},h=i.values,h!=null&&(typeof h=="string"&&(h=h.split(/\s*,\s*/g)),Array.isArray(h)?(s.items.list=[],h.forEach(function(n){typeof n=="string"&&(n={value:n,text:t.prettyText(n,!0)});s.items.list.push(n)}),"default"in i||(i.default=s.items.list[0].value),i.values=s.items.list):typeof h=="object"&&(s.items.controller="data:application/json;base64 "+btoa(JSON.stringify(h)),s.items.style="AutoComplete",s.items.dataValueField="value",s.items.dataTextField="value")),i.style==="DropDownList"&&(s.options.lookup={nullValue:!1}));"default"in i&&(i.type&&i.type.match(/^int/i)&&typeof i.default=="string"&&(i.default=parseInt(i.default)),s.default=i.default);i.placeholder&&(s.placeholder=i.placeholder);l=!1;i.properties&&(l=y(n.scope+"$"+s.name),l==null&&(l=i.expanded===!1));v=a(i,nt);v==null&&"default"in i&&(v=s.default);g[s.name]=v;ft.push(s);c=[];it&&c.push("app-collapsed-cat");i.properties&&(c.push("app-complex"),i.complexOnDemand&&c.push("app-complex-on-demand"));l&&c.push("app-collapsed");o&&c.push("app-collapsed-prop");e('<div data-container="row" ','data-property="',s.name,'"');i.visible&&(s.visibleWhen=i.visible,e('data-visibility="f:',s.name,'"'));e('data-category-name="',n.name,'" ','data-scope="',n.scope,'" ',c.length?'class="'+c.join(" ")+'" ':"",u?'data-depth="'+u+'"':"",">");e(`<span data-draggable="propgrid-divider" style="left:${w}px"></span>`);e(`<span data-control="label" data-field="${s.name}" style="min-width:${w}px;max-width:${w}px;width:${w}px">${s.name}</span>`);e(`<span data-control="field" data-field="${s.name}" style="min-width:${ut}px;max-width:${ut}px;width:${ut}px"`,'"',i.style==="DropDownList"&&!1?' data-select-on-focus="false"':"",">[",s.name,"]<\/span>");i.properties&&e('<span class="app-toggle"><\/span>');e("<\/div>");i.properties&&(i.properties._names.forEach(function(t){var r=i.properties[t];ht(n,r,s.name,u+1,l||o)}),bt(i,s,f.propMap,g))}var o=f.propSet,h=f.use,ft=[],g={},nt=f.target||{},p=[],ct=[],c=[],b={},tt,it,lt=n.dataView()?._survey?.context?.instance===f.instance,et=lt?t.clientRect(i()).width:u("width",f.instance),k=et?Math.min(et,$(window).width()-s()*2):null,ot=k?n.toWidth(k):"xxs",rt=k||n.toWidth(ot),w=Math.min(Math.ceil(rt-s()),u("divider.x",f.instance)||Math.ceil(rt/2)),ut=rt-w-7,st,d;if(f.context||(f.context="generic"),f.propMap={},!h&&o)for(st in o)h||(h=o[st].scope);if(typeof h=="string"&&(h=h.split(/\s*,\s*/)),l(nt,!0),o?(Array.isArray(o)||(o=[o]),o.forEach(function(t){n.propSet(t)})):(o=n.propSet(gt),h=["_unknown"]),h.forEach(function(n){var t=v[n],i,r;if(t){c=c.concat(t._names);for(i in t)r=t[i],r.primary&&(d=i),b[i]=r}else tt="Unknown property set "+n}),tt){n.notify(tt);return}e('<div data-layout="form" data-layout-size="tn">');e('<div data-container="simple">');c.sort((n,t)=>{var i=b[n],r=b[t];return i.text===r.text?0:i.text<r.text?-1:1});d&&(c.splice(c.indexOf(d),1),c.splice(0,0,d));c.forEach(function(n){var i=b[n],r=p.length;it=y(i.scope+"$"+i.name);e('<div data-container="row" ','data-category="',n,'" ','data-scope="',i.scope,'" ','class="',it?"app-collapsed":"",'"',">");e('<span class="app-toggle"><\/span>');e('<span class="app-cat-text">',t.htmlEncode(i.text),"<\/span>");e("<\/div>");i.properties._names.forEach(function(n){var t=i.properties[n];t.primary&&t.visible&&(p[r]=p[r].replace(">",` data-visibility="f:${t.name}">`));ht(i,t,"",0,!1)})});e('<div data-container="row">');e("<\/div>");e("<\/div>");e("<\/div>");l(nt,!1);n.whenPageShown(ni);t.survey({context:f,sharedInstance:f.instance?f.instance+"_PropertiesWindow":null,questions:ft,values:g,options:{modal:{dock:f.location||"right",max:ot,width:k,gap:!1,tapOut:!0,background:"transparent",title:!1,always:!0},actionButtons:!1,discardChangesPrompt:!1,className:"app-propgrid",contentStub:!1},layout:p.join("\n"),init:"propgridinit.app",calculate:"propgridcalc.app"})};n.propGrid.select=function(t){var r,f,u,e;if(t.match(/^\./)&&(t=t.substring(1)),t=t.replace(/\./g,"_"),r=i('[data-property="'+t+'"]'),r.length&&r[0].style.display!="none"){for(f=r.prevAll("[data-category]:first"),f.is(".app-collapsed")&&f.find(".app-toggle").trigger("vclick"),u=r;u.length&&r.is(".app-collapsed-prop");)u=u.prevAll("[data-property].app-complex:first"),u.is(".app-collapsed")&&(u.data("navigating",!0).find(".app-toggle").trigger("vclick"),u.removeData("navigating"));n.scrollIntoView(r,"center");e=r.find('[data-control="label"]');e.is(".app-has-focus")||(r.closest("[data-layout]").find(".app-has-focus").removeClass("app-has-focus"),n.scrollable("focus"),e.trigger("vclick"))}else b()};n.propGrid.edit=function(t){n.propGrid.select(t);r.focus({field:t})};n.propGrid.data=function(t){var i=t?n.treeView.data(t):k().target;return i||{}};n.propGrid.info=b;kt.on("beforemodalcancel.app",()=>{var t,u;if(i().is(".app-propgrid")&&(t=i(".app-has-focus"),t.length))return u=!!$(".app-data-input").length,r.blur(),r.valid()&&(u?t.each(function(){n.hasFocus($(this),u)}):n.activePage(".app-has-focus, .app-was-focused").removeClass("app-has-focus app-was-focused"),n.scrollable("focus")),!1}).on("vclick",".app-propgrid [data-category] .app-toggle, .app-propgrid [data-category]",function(t){var i=$(this).closest("[data-category]"),o=i.data("category"),r=!i.is(".app-collapsed"),u=i.next(),f=$(t.target).is(".app-toggle"),e;if(g(i,!f),ht(r),f||n.dblClick(i)){for(y(i.data("scope")+"$"+o,r===!1?null:r),i.toggleClass("app-collapsed",r);u.length&&u.data("category-name")===o;)u.toggleClass("app-collapsed-cat",r),u.is(":visible")&&(e=u),u=u.next();r||st()}return ct(r),f&&(e?wt(i,e):g(i)),!1}).on("vclick",".app-propgrid-title .app-close",()=>{if(r.valid())return n.goBack(),!1}).on("vclick",".app-propgrid [data-property].app-complex .app-toggle",p).on("vdblclick",'.app-propgrid [data-property].app-complex:not(.app-complex-off) [data-control="label"]',p).on("vdblclick",'.app-propgrid [data-property] [data-control="label"]',function(){var t=$(this),i=r.elementToField(t);i&&i.ItemsStyle==="DropDownList"&&setTimeout(function(){t.is(".app-has-focus")&&($(".app-data-input").trigger("blur"),n.scrollable("focus"),n.hasFocus(t))},150)}).on("datainputfocus.app",".app-propgrid",function(n){var u=n.dataInput.data("field"),f=r.elementToField(n.dataInput),i=f._dataView;t.userVar(`${i._survey.context.instance}.${i._survey.context.propSet._registered}.lastSelected`,u);setTimeout(b,0,n.dataInput)}).on("setvalue.input.app",".app-propgrid",n=>{var t=r.eventToField(n);if(!t.AllowNulls&&String.isBlank(n.inputValue))return n.inputValid=!1,n.inputError=o.Validator.RequiredField,!1}).on("datainputlabel.app",'.app-propgrid [data-control="label"]',function(t){if(!r.valid())return!1;var i=t.dataInput.closest("[data-property]");if(i.length&&(n.hasFocus(i.find('[data-control="field"]')),n.scrollIntoView($(this)),n.saveLastFocusedField(i.data("property")),!t.dblClick||i.is(".app-complex")&&!i.is(".app-complex-off")))return!1}).on("pageautofocus.app",".app-propgrid",function(n){if(!n.reverse)return!1}).on("datainputmove.app",".app-propgrid .app-wrapper",function(t){if(t.direction.match(/left|right/)||t.direction==="down"&&t.keyCode===13){var r=t.textInput,i=r.closest("[data-property]");if(i.length)return n.propGrid.timeout=setTimeout(()=>{r.trigger("blur"),n.scrollIntoView(i),n.hasFocus(i.find('[data-control="field"]')),n.scrollable("focus")}),!1}else return!1}).on("keyboardnavigation.app",".app-propgrid .app-wrapper",function(t){var f=t.direction,e=$(".app-data-input"),u;if(!e.length&&(u=i('[data-control="label"].app-has-focus,[data-container="row"][data-category].app-has-focus'),f.match(/^(up|down|left|right|enter|tab|end|home|edit)$/))){if(f=="end"&&(u=i('[data-control="label"]:visible,[data-container="row"][data-category]:visible').last()),u.length||(f="home"),u.length&&f!=="home"||(u=i('[data-control="label"]:visible,[data-container="row"][data-category]:visible').first()),!u)return;if(u=u.closest('[data-container="row"]'),f==="edit"&&!u.is("[data-category]"))return r.focus({field:u.data("property")}),!1;if(f==="tab")if(u.is("[data-category]"))f=t.originalEvent.shiftKey?"up":"down";else return r.focus({field:u.data("property")}),!1;if(f==="enter")if(u.is(".app-complex:not(.app-complex-off),[data-category]"))f=u.is(".app-collapsed")?"right":"left";else return!1;if(f==="left")if(f="up",u.is(".app-complex:not(.app-complex-off)")){if(!u.is(".app-collapsed"))return p.apply(u[0],{}),!1}else if(u.is("[data-category]")&&!u.is(".app-collapsed"))return u.find(".app-toggle").trigger("vclick"),!1;if(f==="right")if(f="down",u.is(".app-complex:not(.app-complex-off)")){if(u.is(".app-collapsed"))return p.apply(u[0],{}),!1}else if(u.is("[data-category]")&&u.is(".app-collapsed"))return u.find(".app-toggle").trigger("vclick"),!1;return(f==="up"||f==="down")&&(u=f==="up"?u.prevAll('[data-container="row"]:visible'):u.nextAll('[data-container="row"]:visible')),u=u.first(),u.length&&(u.is("[data-category]")?g(u):u.is("[data-property]")&&(u=u.find('[data-control="field"]'),n.hasFocus(u),n.saveLastFocusedField(u),u.closest('[data-container="row"]')),n.scrollIntoView(u)),!1}}).on("keyboardpreview.app",".app-propgrid .app-wrapper",function(t){var u=n.activeElement(),e;if(t.originalEvent.key==="F1"&&$(this).find('[data-control="label"].app-has-focus').length)return i(".app-infopane .app-help").trigger("mousedown"),!1;if(!u.is(":input")&&(u=$(this).find('[data-control="label"].app-has-focus'),u.length)){var o=t.originalEvent,f=o.key||"",s=u.data("field");(f.length===1&&!o.ctrlKey||f.match(/Backspace|Del|Delete/))&&(f.length>1?(e=r.elementToField(u),e&&e.AllowNulls?e.isReadOnly()||r.execute({values:[{field:s,value:null}]}):r._buffer=""):r._buffer=f,t.preventDefault(),r.focus({field:s}))}}).on("paste",function(t){var u=n.activeElement(),f,e;if(!u.is(":input")&&i().is(".app-propgrid")&&(u=$(this).find('[data-control="label"].app-has-focus'),u.length))return f=u.data("field"),e=t.originalEvent.clipboardData.getData("text/plain"),r._buffer=e,r.focus({fieldName:f}),!1}).on("propgridinit.app",function(t){var r=t.survey.context,c,k,d,g,nt,tt,it,l,a;if(!r._initialized){r._initialized=!0;var p=i(),s=n.bar("create",{type:"header",page:p}),rt=n.bar("create",{type:"footer",page:p}),v=r.text?e("app-propgrid-title").appendTo(s).text(r.text):null,y=r.nodes?e("app-top-nav").appendTo(s):null,w=e("app-toolbar app-toolbar-props").appendTo(s),f=e("app-infopane app-has-scrollbars").appendTo(rt).attr("data-context-menu",!0),b=e("app-title").appendTo(f);v&&r.icon&&n.icon(r.icon,v);c=e("app-toolbar app-toolbar-nav").insertAfter(v);k=h("app-btn").appendTo(c).attr({title:o.Pager.Refresh,"data-pg-action":"propgrid.refresh"});n.icon("material-icon-refresh",k);d=h("app-btn").appendTo(c).attr({title:o.PropGrid.CollapseAll,"data-pg-action":"propgrid.collapse-all"});n.icon("material-icon-unfold-less",d);g=h("app-btn").appendTo(c).attr({title:o.PropGrid.Properties,"data-pg-action":"propgrid.properties"});n.icon("material-icon-handyman",g);nt=h("app-btn").appendTo(c).attr({title:o.PropGrid.Pin,"data-pg-action":"propgrid.pin"});n.icon("material-icon-push-pin",nt);h("app-text").appendTo(b);n.icon("material-icon-close",h("app-close").appendTo(v).attr("data-title",o.ModalPopup.Close));e("app-description").appendTo(f);e("app-see-also").appendTo(f);ti().helpUrl&&n.icon("material-icon-help_outline",b).addClass("app-help").attr({title:Web.MembershipResources.Bar.HelpLink,"data-tooltip-location":"above"}).hide();tt=h("app-btn").appendTo(w).toggleClass("app-selected",!0).attr({title:o.PropGrid.Categorized,"data-pg-action":"propgrid.categorized"});n.icon("material-icon-category",tt);it=h("app-btn").appendTo(w).toggleClass("app-selected",!1).attr({title:o.PropGrid.Alphabetical,"data-pg-action":"propgrid.alphabetical"});n.icon("material-icon-sort_by_alpha",it);n.bar("show",s);n.bar("show",f);p.data("infoPane",f);e().attr("data-draggable","propgrid-infopane").insertBefore(f);y&&(n.treeView({container:y,type:r.instance,nodes:r.nodes}),e().attr("data-draggable","propgrid-topnav").insertAfter(y));l=u("topNav.height",null);l&&y.css({height:l,minHeight:l,maxHeight:l});a=u("infoPane.height",r.instance);a&&f.css({height:a,minHeight:a,maxHeight:a});e().attr("data-draggable","propgrid-resizer").insertAfter(s);n.resetPageHeight();n.whenPageShown(pt)}}).on("propgridcalc.app",function(i){var h=i.dataView,b=i.survey,v=b.context,s=v.target||{},e=h.data("modified"),k=[],g=[],nt,tt,y,p,c,it,rt,o,ut,f,u;if(typeof s!="object"){n.notify(`The value of the target is not an object:
${s}`);return}for(f in e._modified)if(u=v.propMap[f],u.confirm){nt=u;break}if(nt&&(tt=t.eval(nt.confirm,e),tt))if(b._userConfirmed)delete b._userConfirmed;else{$app.confirm(tt).then(()=>{b._userConfirmed=!0,setTimeout(()=>{$(document).trigger(i)})}).fail(()=>{var t,i;n.activeElement("blur");t=[];for(i in e._modified)t.push({field:i,value:e._modified[i]});r.execute(t)});return}s._changed=function(n){var t,r,i;if(n instanceof RegExp){t=v.propMap;for(r in t)i=t[r],i.propName.match(n)&&k.push(i.propName)}else k.push(n.replace(/\./g,"_"))};l(s,!0);y=[];p=[];for(f in e._modified){if(u=v.propMap[f],c=e[f],c==null&&"default"in u&&(c=u.default,e._modified[f]==c)){y.push({field:f,value:c});continue}u?.parent?.compound&&(it=bt(u.parent,null,v.propMap,e),e[u.parent.name]!=it&&y.push({field:u.parent.name,value:it}));u.virtual?(u.finish&&p.push(u),u.set&&a(u,s,c),rt=h.findField(u.propName),rt&&(h._originalRow[rt.Index]=c)):(a(u,s,c),s._changed(f))}if(y.length&&(y.forEach(n=>{var t=h.findField(n.field);h._editRow[t.OriginalIndex]=n.value}),t.input.execute({values:y})),k.length){o={_map:{}};l(o,!0);k.forEach(n=>{var t=v.propMap[n],i;if(!t)throw new Error(`Unknown property '${n}' is specified in the change log.`);i=a(t,s);a(t,o,i);o._map[n]=t;t.seeAlso&&(ut=!0)});for(f in o._map){var u=o._map[f],ft=e[u.propName],d=a(u,o);ft!==d&&(d==null&&(d=u.default),g.push({field:f,value:d}))}l(o,!1);clearTimeout(h._studioPatchTimeout);h._studioPatchTimeout=setTimeout(w,100,"edit",{patch:o,data:e,context:v,infoPaneChanged:ut});g.length&&t.input.execute({values:g});for(f in o._map)u=o._map[f],u.finish&&p.push(u)}return l(s,!1),n.activePage(".app-complex-on-demand").each(et),clearTimeout(h._studioFinishTimeout),p.length&&(h._studioFinishTimeout=setTimeout(ri,0,p,s)),!1}).on("mousedown pointerdown touchstart",".app-propgrid .app-infopane .app-help",function(){var r=tt(i("[data-property] .app-has-focus")),t;return r&&(t=n.dataView(),w("help",{path:n.propGrid.toPropPath(r),data:t.data(),context:t._survey.context.target})),!1}).on("resized.app",pt).on("dblclick",'[data-draggable="propgrid-topnav"]',t=>($(t.target).prev().css({height:"",minHeight:"",maxHeight:""}),n.resetPageHeight(),u("topNav.height",null,null),!1)).on("dblclick",'[data-draggable="propgrid-infopane"]',i=>{var l=$(i.target),r=l.next(),a=r.height(),h,c;r.css({height:"",minHeight:"",maxHeight:""});var f="auto",o="none",s="none",e=null,v=r[0].offsetHeight!=r[0].scrollHeight;return r.css({height:f,minHeight:s,maxHeight:o}),n.resetPageHeight(),h=t.clientRect(r),c=t.clientRect(n.scrollable()),h.top<=c.bottom?(r.css({height:"",minHeight:"",maxHeight:""}),n.resetPageHeight()):v&&(e=r.height(),e===a&&(e=null,r.css({height:"",minHeight:"",maxHeight:""}))),f=e==null?"":r.height(),s=f,o=f,r.css({height:f,minHeight:s,maxHeight:o}),u("infoPane.height",null,e),n.resetPageHeight(),!1}).on("dblclick",'[data-draggable="propgrid-divider"]',()=>{u("divider.x",null,null);var n=i(".app-treeview .app-selected:first").removeClass("app-selected");return n.find(">.app-node").trigger("vclick"),!1}).on("dblclick",'[data-draggable="propgrid-resizer"]',()=>{u("width",null,null);var r=i(),f=n.toWidth("xxs"),e=u("divider.x",null);return r.removeData("modalWidth"),it(r,null,f,null,e?f/t.clientRect(r).width*e:null),!1}).on("vclick",'.app-propgrid [data-container="row"]',n=>{if(!n.isDefaultPrevented()){var t=$(n.target).prev().find('[data-control="label"]');if(!t.is(".app-has-focus"))return t.trigger("vclick"),!1}}).on("vclick",'.app-propgrid [data-input="none"]',t=>{var i=$(t.target).closest('[data-container="row"]'),u=i.find('[data-control="label"]'),r;return u.is(".app-has-focus")||(u.trigger("vclick"),r=!0),n.dblClick(i)&&i.is(".app-complex")&&(i.find(".app-toggle").trigger("vclick"),r=!0),r?!1:void 0}).on("vclick",".app-propgrid [data-pg-action]",n=>{var t=$(n.target).closest("[data-pg-action]"),i=t.attr("data-pg-action");return t.is(".app-disabled")||setTimeout(w,0,"action",{action:i,button:t}),!1}).on("treeview.app",n=>{if(n.treeView.eventName==="select"){var i=w("fetch").propGrid,t=i.result;if(!t)return;t.then(n=>{var t=k(),i=n[0],r=n[1];$app.touch.propGrid("show",{instance:t.instance,propSet:i,target:r})})}}).on("propgrid.app",t=>{if(!t.isDefaultPrevented()&&t.propGrid.eventName==="action"){switch(t.propGrid.action){case"propgrid.properties":n.scrollIntoView(n.activePage(".app-treeview .app-selected:first > .app-node"),"center");n.scrollable("focus");break;case"propgrid.collapse-all":var i=n.activePage(".app-treeview .app-selected:first"),r=i.parents("li");r.length&&(i=r.last());n.activePage(".app-treeview .app-selected").removeClass("app-selected");n.activePage(".app-treeview .app-expanded").removeClass("app-expanded").addClass("app-collapsed");i.find(">.app-node").trigger("vclick");i.length&&i[0].scrollIntoView({block:"center",behavior:"instant"});break;case"propgrid.refresh":n.activePage(".app-treeview .app-selected").removeClass("app-selected");n.activePage(".app-treeview .app-expanded").removeClass("app-expanded").addClass("app-collapsed");n.propGrid("show",{instance:k().instance});n.treeView({treeView:t.treeView.treeView});break;default:n.notify(t.propGrid.action)}return ot(),!1}});t.dragMan["propgrid-topnav"]={options:{taphold:!1,immediate:!1},start:function(u){var f=this,o=u.target,s;s=t.clientRect(o);u.dir="all";f._target=o.addClass("app-dragging");f._deltaY=s.top-u.y;var e=i(".app-bar-header .app-top-nav"),h=t.clientRect(e),c=n.scrollable(),l=t.clientRect(c);f._topNav=e;f._topNavHeight=e.height();f._minY=u.y-Math.ceil(h.height-(n.settings("ui.propGrid.minTopNavHeight")||80)+1);f._maxY=Math.ceil(h.bottom+(l.height-rt()))-1;r.blur()},move:function(n){var t=this,i=n.y+t._deltaY;i<t._minY&&(t._newY=i);i>t._maxY&&(i=t._maxY);i!=t._newY&&(t._newY=i,t._position())},cancel:function(){var t=this;t._target.removeClass("app-dragging");delete t._target;t._topNavHeight&&t._position(t._topNavHeight);delete this._topNav;n.scrollable("refresh")},end:function(){u("topNav.height",null,this._topNav.height());delete this._topNavHeight;this.cancel()},_position:function(i){var u=this._topNav,f=t.clientRect(u),r=i||Math.ceil(f.height+(this._newY-f.bottom));u.css({height:r,maxHeight:r,minHeight:r});n.resetPageHeight()}};t.dragMan["propgrid-infopane"]={options:{taphold:!1,immediate:!1},start:function(u){var f=this,o=u.target,s;s=t.clientRect(o);u.dir="all";f._target=o.addClass("app-dragging");f._deltaY=s.top-u.y;var e=i(".app-bar-footer .app-infopane"),h=t.clientRect(e),c=n.scrollable(),l=t.clientRect(c);f._infoPane=e;f._infoPaneHeight=e.height();f._minY=h.top-Math.ceil(l.height-rt()+1);f._maxY=Math.ceil(h.bottom-(n.settings("ui.propGrid.minInfoPaneHeight")||50));f._padding=Math.floor(parseFloat(e.css("padding-bottom"))+parseFloat(e.css("padding-top")));r.blur()},move:function(n){var t=this,i=n.y+t._deltaY;i<t._minY&&(i=t._newY);i>t._maxY&&(i=t._maxY);i!=t._newY&&(t._newY=i,t._position())},cancel:function(){var t=this;t._target.removeClass("app-dragging");delete t._target;t._infoPaneHeight&&t._position(t._infoPaneHeight);delete t._infoPane;n.scrollable("refresh")},end:function(){u("infoPane.height",null,this._infoPane.height());delete this._infoPaneHeight;this.cancel()},_position:function(i){var u=this._infoPane,f=t.clientRect(u),r=i||Math.ceil(f.height+(f.top-this._newY)-this._padding);u.css({height:r,maxHeight:r,minHeight:r});n.resetPageHeight()}};t.dragMan["propgrid-divider"]={options:{taphold:!1,immediate:!1},start:function(n){var i=this,u=n.target,o=t.clientRect(u),f,e;n.dir="all";i._deltaX=o.left-n.x+7;f=u.closest('[data-layout="form"]');e=i._formRect=t.clientRect(f);i._x=parseInt(u.css("left"));i._minX=e.left+s()-1;i._maxX=e.right-s()-7;i._dividers=f.find('[data-draggable="propgrid-divider"]');r.blur()},move:function(n){var t=this,i=Math.round(n.x+t._deltaX);i<t._minX&&(i=t._minX);i>t._maxX&&(i=t._maxX);i=i-t._formRect.left+1;i!=t._newX&&t._position(i)},cancel:function(){var n=this;n._x!=null&&n._position(n._x);delete n._target;delete n._dividers},end:function(){u("divider.x",null,this._newX);delete this._x;this.cancel()},_position:function(n){var t=this;t._newX=n;at(t._dividers,t._formRect.width,n)}};t.dragMan["propgrid-resizer"]={options:{taphold:!1,immediate:!1},start:function(n){var i=this,u=n.target,e=t.clientRect(u),f,o;n.dir="all";i._target=u;u.addClass("app-dragging");f=i._page=u.closest(".ui-page");i._location=f.is(".app-page-modal-dock-left")?"left":"right";i._width=parseInt(f.css("min-width"));i._availWidth=$(window).width();i._minX=s()*2;i._maxX=i._availWidth-i._minX;i._deltaX=e.left-n.x+(i._location==="left"?e.width:0);o=i._dividers=f.find('[data-draggable="propgrid-divider"]');o.length&&(i._dividerX=parseInt(i._dividers[0].style.left));r.blur()},move:function(n){var t=this,i=Math.round(n.x+t._deltaX),r;i<t._minX&&(i=t._minX);i>t._maxX&&(i=t._maxX);r=t._location==="left"?i:t._availWidth-i+1;r!=t._newWidth&&t._position(r)},cancel:function(){var n=this;n._width!=null&&n._position(n._width);n._target.removeClass("app-dragging");delete n._target;delete n._dividers;delete n._page},end:function(){var n=this,t;u("width",null,n._newWidth);n._dividers.length&&(t=parseInt(n._dividers[0].style.left),u("divider.x",null,Math.abs(t-n._newWidth/2)>1?t:null));delete n._width;n.cancel()},_position:function(n){var t=this;t._newWidth=n;it(t._page,t._dividers,n,t._width,t._dividerX)}};n.propGrid.toPropPath=function(n){for(var i=[],t=n;t;)i.splice(0,0,t.name),t.parent?(i.splice(0,0,"."),t=t.parent):(i.splice(0,0,t.scope+"://"),t=null);return i.join("")}})()