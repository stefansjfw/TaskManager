/*!
* Touch UI - Tree View
* Copyright 2023-2024 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function h(n,t){var r,i;for(r in n)i=n[r],t&&(i.parent=t),i.nodes&&h(i.nodes,i)}function r(t){var i=n.treeView._navigating;return arguments.length&&i!=t&&(n.treeView._navigating=t,n.activePage(".app-treeview").css("visibility",t?"hidden":"")),i}function o(i,u){var s,e,c,f,l,w,h,a,v,y,p;if(typeof u=="string"){if(s=u.match(/^(.+?)\:\/\/(.+)$/),s)if(e=n.treeView.context(i),e.hierarchy.endsWith("."+s[1]))u=s[2];else{if(r(!1),e.eventName="navigate",e.path=u,c=$.Event("treeview.app",{treeView:e}),$(document).trigger(c),c.isDefaultPrevented())return;n.notify({text:`Unable to navigate to ${u}`,duration:"long"})}if(u.match(/^\./)){r(!1);n.propGrid.select(u.substring(1));return}u=u.split(/\//g);u.forEach((n,t)=>{n.match(/^\./)||(n=n.toLowerCase()),u[t]=decodeURIComponent(n)})}u.length&&(i.find(">li").each(function(){var n=$(this),t=n.data("nodeId");if(t===u[0])return f=n,!1}),f?(u._cleared||(f.closest(".app-treeview").find(".app-selected").removeClass("app-selected"),u._cleared=!0),u.splice(0,1),l=!0,u.length===1&&u[0].match(/^\./)?(w=n.dataView(),t.userVar(`${w._survey.context.instance}.navigate`,u[0])):u.length&&(l=!1,f.is(".app-collapsed")&&f.find(">.app-node>.app-toggle").trigger("vclick"),o(f.find("ul"),u)),l&&(h=f.data("navigating",!0).find(">.app-node").trigger("vclick"),f.removeData("navigating"),a=h.find(".app-anchor")[0],n.busy()||r()?a.scrollIntoView({block:"center",behavior:"instant"}):(v=t.clientRect(h.closest(".app-treeview")),y=t.clientRect(h),y.top>v.top&&y.bottom<v.bottom||n.pageShown(()=>{setTimeout(()=>{a.scrollIntoView({block:"center",behavior:"smooth"})})})),r(!1))):(p=i.find(">.app-loading"),p.length?p.data("navigate",u):r(!1)))}function f(n,i,r){var s,p,l,b,k,d;for(s in i){var o=i[s],v=t.eval(o.text,r)||t.prettyText(s,!0),g=o.id?t.eval(o.id,r):v;(o.text==null||o.text===v)&&(g=s);var tt=o.type,a=w().attr({"data-type":tt}).appendTo(n).data({nodeName:s,nodeTemplate:o,nodeData:r,nodeId:encodeURIComponent(g.toLowerCase())}),h=u("app-node").appendTo(a),it=u("app-anchor").appendTo(h),nt=u("app-text").appendTo(h).text(v);o.textMuted&&(p=t.eval(o.textMuted,r),p!=null&&u("app-muted").appendTo(h).text(p));l=o.icon;l&&(l=t.eval(l,r),b=l.match(/^material\-icon\-(.+)$/),b?iconElem=y("i","app-icon material-icon").text(b[1].replace(/\W/i,"_")).appendTo(nt):h.addClass(l));o.iterate&&r==null?(h.text("Loading..."),a.addClass("app-loading"),k=n.closest("li"),(!k.length||k.is(".app-expanded"))&&c(s,o,n,a)):(d=o.tooltip,d&&nt.attr("data-title",d),o.nodes&&(a.addClass(o.expanded?"app-expanded":"app-collapsed"),u("app-toggle").appendTo(h),f(e().appendTo(a),o.nodes)))}}function c(n,t,i,r){var e=l("iterate",r),u;if(e.isDefaultPrevented()){r.remove();return}u=e.treeView.result;u instanceof Promise||(Array.isArray(u)||(u=[u]),u=Promise.resolve(u));u.then(u=>{var s={},e;s[n]=t;u.forEach(n=>{f(i,s,n)});e=r.data("navigate");r.remove();u.length||i.closest("li").removeClass("app-expanded").find(".app-node .app-toggle").remove();e?o(i,e):a(i.parent())})}function b(t,i){var r=t,u,f;"nodeName"in t&&"nodeData"in t||(r=n.treeView.context(t));t=r.nodeElem;u={};u[r.nodeName]=r.node;f=e();n.treeView.createNodes(f,u,i);f.children().insertAfter(t).toggleClass("app-selected",t.is(".app-selected"));t.remove()}function l(i,r){var u=n.treeView.context(r),f,e;return(u.eventName=i,i==="select"&&t.userVar("treeview."+u.hierarchy,u.nodePath),f=$.Event("treeview.app",{treeView:u}),i==="iterate"&&u.node.when&&(e=t.eval(u.node.when,u.nodeData),!e))?(f.preventDefault(),f):($(document).trigger(f),f)}function a(n){var u,i;if(!r()){var o=t.clientRect(n),s=n.closest(".app-treeview"),f=t.clientRect(s),e=n.find("> ul"),h=t.clientRect(e);h.bottom>f.bottom&&(u="start",i=n,o.height<f.height&&(i=e,u="end"),i.length&&i[0].scrollIntoView({block:u,behavior:"smooth"}))}}var t=$app,s=t.input,n=t.touch,k=$(document),v=Web.DataViewResources,d=v.Data.BooleanDefaultItems,g=t.clientRect,i=t.html,nt=i.tag,tt=i.div,it=i.span,y=i.$tag,rt=i.$p,p=i.$div,u=i.$span,ut=i.$a,ft=i.$i,w=i.$li,e=i.$ul;n.treeView=function(i,u,s){var l,c,a;(!s||(n.treeView.ready=!0,s(),i))&&(typeof i!="string"&&(u=i,i="show"),l=u.nodes,l instanceof Promise?l.then(t=>{u.nodes=t.nodes||{},n.treeView(i,u)}):(h(l),c=u.treeView,c?(l=u.nodes||c.data("nodes"),f(e().appendTo(c.empty()),l,null)):(c=p("app-treeview app-has-scrollbars").attr({"data-hierarchy":u.type,tabindex:-1}).data({nodes:l}),f(e().appendTo(c),l,null),u.container&&c.appendTo(u.container),u.before&&c.insertBefore(u.before),u.after&&c.insertAfter(u.after)),c.toggleClass("app-treeview-noicons",u.icons===!1),a=u.path||t.userVar("treeview."+u.type),a&&(r(!0),o(c.find("ul"),a))))};$(document).on("vclick",".app-toggle",n=>{var t,i;if(s.valid())return t=$(n.target).closest("li"),t.is(".app-expanded")?t.removeClass("app-expanded").addClass("app-collapsed"):(t.removeClass("app-collapsed").addClass("app-expanded"),i=!0,t.find("> ul > li.app-loading").each(function(){var n=$(this),t=n.data();c(t.nodeName,t.nodeTemplate,n.parent(),n);i=!1}),i&&a(t)),!1}).on("vclick",".app-treeview li span",i=>{var f=$(i.target),a,u,o,e,h,c;if(s.valid())return(u=f.closest("li"),u.is(".app-loading"))?!1:!f.is(".app-toggle")&&n.dblClick($(f))?(u.find("> .app-node .app-toggle").trigger("vclick"),!1):i.isDefaultPrevented()||u.is(".app-selected")?!1:(a=f.closest(".app-treeview"),u=f.closest("li"),a.find(".app-selected").removeClass("app-selected"),u.addClass("app-selected"),o=f.closest(".app-node"),e=null,r()||u.data("navigating")||(h=t.clientRect(o),c=t.clientRect(u.closest(".app-treeview")),h.bottom>c.bottom?e="end":h.top<c.top&&(e="start")),e&&o[0].scrollIntoView({block:e,behavior:"smooth"}),setTimeout(l,e?96:0,"select",u),!1)}).on("vclick","[data-studio-link]",n=>{var t,i,u;if(s.valid())return t=$(n.target),i=t.closest("[data-studio-link]").attr("data-studio-link"),i&&(u=t.closest(".app-propgrid").find("[data-hierarchy]"),r(!0),o(u.find(">ul"),i)),!1});n.treeView.data=function(t){var i;return t?Array.isArray(t)||(t=t.split(/\s*,\s*/g)):i={},n.activePage(".app-treeview .app-selected:first .app-node").parents("li").each(function(){var r=$(this),n=r.attr("data-type"),u=r.data("nodeData");if(t){if(t.forEach(t=>{t===n&&(i=u)}),i)return!1}else n&&(i[n]=u||{})}),i};n.treeView.context=function(t){t||(t=n.activePage(".app-treeview .app-selected:first"));for(var u=t.length?t.closest(".app-treeview"):n.activePage(".app-treeview"),e=u.attr("data-hierarchy"),o=t.data("nodeName"),s=t.data("nodeTemplate"),r,i=t,f=[];i.length;)f.splice(0,0,i.is(".app-loading")?"*":i.data("nodeId")),r==null&&(r=i.data("nodeData")),i=i.parent().closest("li");return{hierarchy:e,treeView:u,node:s,nodeName:o,nodePath:f.join("/"),nodeData:r,nodeElem:t}};n.treeView.createNodes=f;n.treeView.replaceNode=b})()