/*!
* App Studio Core shared by app and the studio
* Copyright 2017-2024 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function kt(){if(n.busy())setTimeout(kt,100);else{var u=t.studio.state(),r=u.trigger;r&&(r==="reload"?t.studio.state(null):i?f("show"):y())}}function c(n){parent.postMessage(n,location.href)}function v(n){l&&l[0].contentWindow.postMessage(n,location.href)}function y(t){if(!n.busy())if(t||(t={inspect:!1}),i)$(".studio-btn-inspect").attr({"data-studio-action":"inspect-end","data-title":"End Inspection"}).find("i").text("arrow_selector_tool"),e.addClass("studio-inspecting"),a=!0;else{t.event&&(ut=t);$(document.activeElement).trigger("blur");n.tooltip(!1);n.notify(!1);try{window.location.hash&&(nt=window.history.state)}catch(r){}n.busy(!0);t.inspect&&$(".studio-btn-inspect i").text("arrow_selector_tool");l=$(`<iframe class="studio-frame" src="${__baseUrl}_appstudio?_showNavigation=false&inspect=${t.inspect?"true":"false"}"></iframe>`).css("left",-1e4).appendTo(e).trigger("focus")}}function p(){if(i&&!n.busy()&&!f(":active")){var t=$.touch.navigate.history.activeIndex+1;t>2?(n.whenPageShown(p),window.history.go(2-t)):c({method:"hide"})}}function hi(n){return n.name==="Responsive"&&o.width===r.physicalWidth-112&&o.height===r.physicalHeight-112||o.width===n.width&&o.height===n.height||o.width===n.height&&o.height===n.width}function et(){if($(".app-bar-notify").removeData("notify"),i)f(":active")?pt():(p(),c({method:"exit"}));else{if(r.isVirtual){var u=n.device();u&&t.userVar("lastVirtualDevice",u);t.storage.set(window.location.host+"_VirtualDeviceHint","off");t.userVar("studioOnStart?",!1);d({name:"Responsive"});n.screen("resize");dt()}lt()}}function dt(i){i?t.storage.get(window.location.host+"_VirtualDeviceHint")!=="off"&&setTimeout(()=>{n.notify({text:"App Studio mode was started automatically. Use the studio controls to modify this application. You can exit to the app at any time.",duration:"long",buttonText:"Disable",buttonEvent:"studioonstartdisabled.app"})},1e3):n.notify({text:'<div>Press Ctrl+Shift+D or chose the "Design" option\nin the "More" menu to start the App Studio.<\/div>',html:!0,duration:"long",buttonText:"Design",buttonEvent:"studioactioninspectstart.app"})}function gt(){var n=$(parent.window.document).find(".ui-page-active .app-wrapper");wt=n[0].scrollHeight-n.height()}function ci(n){var t=n.keyCode||n.which;if(!n.isDefaultPrevented()&&t===27&&$(".ui-page-active#studio").length)return g.is(":visible")?tt():setTimeout(p),!1}function w(){return Promise.all([t.studio.getScript("~/js/studio/tools.js"),t.studio.getScript("~/css/appstudio-icons.css")]).catch(t=>{n.notify(ct(t));throw t;})}function tt(){g&&(g.hide(),$(".studio-inspection-result").hide())}function li(n){window.open("https://codeontime.com/roadmap/v9?topic="+encodeURIComponent(n.path))}function ai(){var t=n.dataView(),i;if(t)for(i in t._pageSession)i.match(/(_listOfValues_|_listCache)/)&&delete t._pageSession[i]}function vi(t,i){var r;if(n.notify(!1),r=t.context.target,r?._links){var u=r._links[t.eventName],e=t.patch,o=e._map;delete e._map;u||t.eventName!=="edit"||(u=r._links.replace,u&&(e=new FormData,e.append("value",new Blob([JSON.stringify(r)],{type:"application/json"}))));u&&rt({url:u,body:e}).then(t=>{var s,u,h,l,a,e,v;n.treeView.replaceNode(i,t);s=[];for(e in o)h=o[e],u=ni(u,h),u=="none"&&h.alterApp&&s.push(h.alterApp);if(s.length&&(r._context=n.treeView.data(),c({method:"alterUI",scripts:s,context:r}),delete r._context),u!="none"&&f("trigger",u),l=n.dataView(),a=l?.data(),a){for(e in a)v=l.findField(e),v&&(l._originalRow[v.Index]=a[e]);ai()}}).catch(k)}}function ni(n,t){var n,i;return typeof t=="object"&&(i=t,t=i.alterApp?"none":i.trigger||"reload"),t?t==="none"?n||(n=t):t==="generate"?n!=="refresh"&&n!=="sync"&&(n=t):t==="reload"?n!=="generate"&&n!=="refresh"&&n!=="sync"&&(n=t):t==="refresh"?n!=="sync"&&(n=t):n=t==="sync"?t:"none":n="reload",n}function s(i){var s=i.target||e,r=i.action,o=$.Event("studioaction"+r.replace(/\-/g,"")+".app"),u;if(f(":log"))return n.notify("App Studio is busy. Please wait..."),!1;if(f(":active")&&r.match(/^(exit|rotate|device|publish|inspect\-(start|end))$/))return pt(r),!1;tt();s.trigger(o);o.isDefaultPrevented()||(u=b[r],u?(b._last=r,n.notify({text:u.text+` is not supported in the release ${__settings.version}. The roadmap provides information about the alternative and the expected avaialability of this feature in the App Studio.`,duration:"long",buttonText:"Learn",buttonEvent:"studiofeature.app"})):r==="help"?window.open("https://codeontime.com/roadmap/v9","_blank"):w().then(()=>{var i=t.studio.tools[r];i?i.run():n.notify(`Tool "${r}" is not supported."`)}).catch(()=>{}))}function st(t){let i=b[t];if(i&&!i._notified&&(i._notified=!0,!$(".studio-selector:visible").length)){var r=__settings.version.split(/\./g);r.splice(r.length-1,1,"0");n.notify({text:i.text+` is not fully implemented in the release ${r.join(".")}. The roadmap provides information about the alternative and the expected avaialability of this feature in the App Studio.`,duration:"long",buttonText:"Learn",buttonEvent:"studiofeature.app"})}}function k(t){n.notify(ct(t))}function ti(t){f("error");n.notify({text:"The app is not operational. Review the log for errors."+(t?"Error: "+t.message:""),duration:"long"})}function ht(n){var t=$app.studio.tools.cache[n];return t?Promise.resolve(t):rt({url:n,cache:!0}).then(t=>($app.studio.tools.cache[n]=t,Promise.resolve(t)))}function yi(n){if(!n)return Promise.resolve(null);var t=$app.studio.tools.cache[n];return t?Promise.resolve(t):rt({url:`/v2/studio/objects/${n}/definition`,cache:!0}).then(t=>{for(var i in t)t[i].scope=n;return $app.studio.tools.cache[n]=t,Promise.resolve(t)})}function ii(n){var i=n.hypermedia,r=n.context;return!i&&!r?Promise.resolve(null):(i=r?i:`projects >> ${t.id} >> ${i}`,rt({hypermedia:i,context:r,cache:!0}).then(n=>Array.isArray(n)?Promise.resolve({collection:n}):Promise.resolve(n)))}function it(i){var r=i.result.sessionId;r&&t.restful({baseUrl:n.studio(),hypermedia:`projects >> ${t.id} >> session >>`,body:{parameters:{sessionId:r}},token:t.studio.token}).then(t=>{var r=t.result.log,i,e,o,s;r.length&&(i=f(),e=-1,r.every((n,t)=>(n.match(/\.(\w+)?Exception/)&&!i.data("exception")&&(e=t),e===-1)),e!==-1&&(o=r.slice(0,e),o.length&&u().text(o.join("\n")).appendTo(i),u().attr("style","background-color:red;").text(r[e]).appendTo(i),r.splice(0,e+1),i.data("exception",!0)),r.length&&u().text(r.join("\n")).appendTo(i),i.scrollTop(i[0].scrollHeight-i.height()));t.result.done?(s=i.data("exception"),s?n.notify({text:"An exception was detected. Please review the log.",duration:6e4}):ri()):setTimeout(it,t.result.timeout,t)}).catch(k)}function ri(){var t="The app is about to reload...";f(":log")&&(t="The project has been regenerated. "+t);n.notify({text:t,duration:"long"});fetch("_appstudio").then(n=>n.text()).then(n=>{function r(){if(!r._done){r._done=!0;var i=n.match(/<code><pre>([\s\S]+)?<\/pre><\/code>/);i&&$(i[0]).appendTo(t)}}var t=f(),u,i;if(n.match(/var __settings=\{/))c({method:"reload"});else{for($("<div><br/><\/div>").appendTo(t),u=/<b>(.+):\s*<\/b>(.+)\r*\n/g,i=u.exec(n);i;)$("<div>"+i[0].replace(/<br>/g,"")+"<\/div>").appendTo(t),i[2]&&!i[2].replace(/<br>/g,"")&&r(),i=u.exec(n);r();t.scrollTop(t[0].scrollHeight-t.height());ti()}}).catch(ti)}function ct(i){var u=i||{message:"Unable to execute"},r=i.errors,f=[];return r&&r.forEach(n=>f.push(n.message)),{text:r?f.join("\n"):t.studio.tools?u.message+(i.stack?`
Stack:${i.stack}`:""):`Start "${n.appName()}" from the App Studio.
Error: ${u.message}.`,duration:3e4}}function lt(){i||e.toggleClass("studio-hidden",r.width===r.physicalWidth)}function pi(i){function r(n,i){n!=null&&(n===""&&(n="(blank)"),o.length&&o.push(" / "),o.push(`<span title="${i}" data-tooltip-location="above">${t.htmlEncode(n)}</span>`))}var o,f,s,h;if(!i){$(".studio-inspection-result").empty();return}o=[];r(i.controller,"Controller");i.type==="page"?r(i.page,"Page"):i.action?(r(i.actionGroup,"Action Group"),r(i.action,"Action")):(r(i.view,"View"),r(i.category,"Category"),r(i.fieldName,"Data Field"));i.property&&r(t.prettyText(i.property),"Property");f=$(".studio-inspection-result");f.length||(f=u("studio-inspection-result").appendTo(e));f.html(`<span class="path"><b>${t.prettyText(i.type,!0)}</b>: ${o.join("")}</span>`).show();s=f.find(".path");resultRect=t.clientRect(s);h=t.clientRect($('[data-studio-action="device"]'));f.hide();h.right>resultRect.left?n.notify({text:s.html(),duration:"long",htmlEncode:!1}):(n.notify(!1),setTimeout(()=>f.css("color","#ff0000").fadeIn(750)))}function at(f){var o,s,v,c,l,h;(i||r.isVirtual||t.userVar("studioOnStart?")===!1||(d({name:"Responsive",width:"auto",height:"auto"}),n.screen("resize")),$(".studio-btn-inspect").length)||(f&&(e.addClass("studio-controls-hidden"),r.isVirtual&&!i&&dt(!0)),lt(),o=u("studio-toolbar studio-toolbar-top").appendTo(e),s=i&&a,n.icon("material-icon-"+(s?"arrow-selector-tool":"point_scan"),u("studio-btn studio-btn-inspect").attr({"data-studio-action":s?"inspect-end":"inspect-start",title:s?"End Inspection":"Inspect"}).appendTo(o)),n.icon("material-icon-settings",u("studio-btn").attr("data-studio-action","settings").attr("title","Settings").appendTo(o)),n.icon("material-icon-account-tree",u("studio-btn").attr("data-studio-action","models").attr("title","Models").appendTo(o)),n.icon("material-icon-menu-book",u("studio-btn").attr("data-studio-action","pages").attr("title","Pages").appendTo(o)),n.icon("material-icon-webhook",u("studio-btn").attr("data-studio-action","develop").attr("title","Develop").appendTo(o)),n.icon("material-icon-folder-open",u("studio-btn").attr("data-studio-action","open").attr("title","Show Source Code").appendTo(o)),n.icon("material-icon-sync",u("studio-btn").attr("data-studio-action","sync").attr("title","Sync Design").appendTo(o)),n.icon("material-icon-publish",u("studio-btn").attr("data-studio-action","publish").attr("title","Publish").appendTo(o)),n.icon("material-icon-exit-to-app",u("studio-btn").attr("data-studio-action","exit").attr("title","Exit to App").appendTo(o)),n.icon("material-icon-screen-rotation-alt",u("studio-btn").attr("data-studio-action","rotate").attr("title","Rotate").appendTo(o)),v=u("studio-toolbar studio-toolbar-bottom").appendTo(e),c=u("studio-btn").attr("data-studio-action","device").attr("title","Device").attr("data-tooltip-location","above").attr("data-tooltip-align","left").appendTo(v),n.icon("material-icon-devices",c),u("studio-btn-label").appendTo(c).text("iPad 1024 x 768"),l=u("studio-toolbar studio-toolbar-left").appendTo(e),n.icon("material-icon-apps",u("studio-btn").attr("data-studio-action","apps").attr("title","Apps").appendTo(l)),n.icon("material-icon-widgets",u("studio-btn").attr("data-studio-action","widgets").attr("title","Widgets").attr("data-tooltip-location","above").attr("data-tooltip-align","left").appendTo(l)),h=u("studio-toolbar studio-toolbar-right").appendTo(e),n.icon("material-icon-more-"+(t.agent.android?"vert":"horiz"),u("studio-btn").attr("data-studio-action","more").attr("title","More").appendTo(h)),n.icon("material-icon-build",u("studio-btn").attr("data-studio-action","explore").attr("title","Project Explorer").attr("data-tooltip-location","left").appendTo(h)),n.icon("material-icon-help",u("studio-btn").attr("data-studio-action","help").attr("title","Help").attr("data-tooltip-location","left").appendTo(h)),i||(yt(),vt()),ui(),f&&setTimeout(()=>e.removeClass("studio-controls-hidden"),32))}function wi(n){d(n.device,n.exitStudio)}function d(t,u){if(t=JSON.parse(JSON.stringify(t)),i)o=t,t.autoRotate=!0,c({method:"changeDevice",device:t,exitStudio:u});else{fi=t;var f=t.width,e=t.height;f==null?r.isVirtual=!1:f==="auto"?r.isVirtual=!0:(r.isVirtual=!0,r.width=f,r.height=e,t.width=r.width,t.height=r.height);t.autoRotate&&(delete t.autoRotate,e!=="auto"&&e>r.physicalHeight-112&&t.height>f&&(t.width=r.width=e,t.height=r.height=f));n.device(t);r.deviceWidth=r.deviceHeight=null;n.screen("resize");vt(t)}}function vt(t){t||(t=n.device());var i=t.name!=="Responsive";$('[data-studio-action="rotate"]').toggleClass("studio-btn-hidden",!i);v({method:"studioToolsChanged",tools:{rotate:i}})}function bi(){var i=n.device(),t=bt.find(n=>n.name===i.name);return(t&&t.width==="auto"||!i.name)&&(t={name:"Responsive",width:r.physicalWidth-112,height:r.physicalHeight-112}),t||i}function yt(){if(!i){var f=$('[data-studio-action="device"] .studio-btn-label'),t=n.device(),e=t.width==="auto"||t.width===r.width&&t.height==r.height?t.name+" ":"",u=`${e}${r.width} x ${r.height}`;f.html(u);v({method:"virtualDeviceChanged",options:{text:u,screen:r}})}}function pt(i){var u=t.studio.state(),r=u?.trigger||"reload";n.notify({text:(i?"This tool is not available in the changed application.":"Application has changed. Use the available studio tools to make other changes.")+` Click anywhere in the app boundaries to ${r}.`,duration:"long",buttonText:r,buttonEvent:"execstudiotrigger.app"})}function ui(){i&&$(".studio-app-shield").length&&["inspect-start","inspect-end","exit","rotate","publish","device"].forEach(n=>$(`[data-studio-action="${n}"]`).addClass("studio-disabled"))}function f(r,s){var h,c;if(s==null&&(s={}),h=s.shield||$(".studio-app-shield"),r){if(!i&&!r.match(/^\:/)){v({method:"shield",args:{method:r,options:s}});return}switch(r){case"show":h.length||(h=u("studio-app-shield").appendTo(e),f("reposition",{shield:h}));ui();break;case"reposition":h.css({left:o.left,top:o.top,right:o.right,bottom:o.bottom});break;case"trigger":h.length||(h=f("show"));c=t.studio.state();c.trigger=ni(c.trigger,s);t.studio.state(c);h.removeClass("studio-log").removeData("exception").empty();break;case"log":h.length||(h=f("show").attr("data-context-menu",!0));h.addClass("studio-log").removeData("exception").empty().removeClass("studio-error");n.notify(!1);break;case":log":return h.is(".studio-log:not(.studio-error)")&&!h.data("exception");case":active":return!!h.length;default:if(r.match(/^\:/))return h.is(".studio-"+r.substring(1));h.addClass("studio-"+r)}}return h}function ki(){var n=t.studio.state();switch(n.trigger){case"reload":t.studio.state(null);ri();break;case"generate":t.studio.state(null);f("log");w().then(()=>t.studio.tools.generate.run()).then(it).catch(ot);break;case"refresh":t.studio.state(null);f("log");w().then(()=>t.studio.tools.sync.run({metadata:!1})).then(it).catch(ot);break;case"sync":t.studio.state(null);f("log");w().then(()=>t.studio.tools.sync.run({metadata:!0})).then(it).catch(ot)}}function ot(n){f().remove();k(n)}function rt(i){return i.baseUrl=n.studio(),i.token=t.studio.token,t.restful(i)}var t=$app,n=t.touch,l,g,e=$("body"),i,a,nt,wt,bt=[{name:"Responsive",width:"auto",height:"auto"},{name:"iPhone SE ",width:375,height:667},{name:"iPhone XR",width:414,height:896},{name:"iPhone 12 Pro",width:390,height:844},{name:"Pixel 5",width:393,height:851},{name:"Pixel 7",width:412,height:783},{name:"Pixel 7 Pro",width:412,height:892},{name:"Pixel 8 Pro",width:448,height:998},{name:"Samsung Galaxy S8+",width:360,height:740},{name:"Samsung Galaxy S20 Ultra",width:412,height:915},{name:"iPad Air",width:820,height:1180},{name:"iPad Mini",width:768,height:1024},{name:"iPad Pro",width:1024,height:1366},{name:"Surface Pro 7",width:912,height:1368},{name:"Surface Duo",width:540,height:720},{name:"Galaxy Fold",width:280,height:653},{name:"Samsung Galaxy A51/71",width:412,height:914}],fi,o={},r=n.screen(),ut,ft,ei={studio:!0,inspect:!0,text:"Design",desc:"App Studio",icon:"material-icon-build",shortcut:"Ctrl+Shift+D",toolbar:!1,sidebar:!1,callback:()=>y({inspect:!0})},oi={studio:!0,inspect:!0,text:"Exit to App",desc:"App Studio",icon:"material-icon-exit-to-app",shortcut:"Ctrl+Shift+D",toolbar:!1,sidebar:!1,callback:et},b={apps:{text:"Apps Directory",url:"id.usg03cqgj9ij"},settings:{text:"Project Settings editor",url:"id.ryz0l8ywajq0"},models:{text:"Model Builder",url:"id.tnjobt7r90rf"},pages:{text:"Navigation Menu editor",url:"id.tnjobt7r90rf"},restful:{text:"RESTful API Mode",url:"id.ko25gif05jss"},widgets:{text:"Widgets menu",url:"id.tbrssg6y5jeb"},explore:{text:"Project Explorer",url:"id.6vqwqh1rfqxa"},publish:{text:"Publishing",url:"id.5f7dfyfh4a7x"}},h=t.html,di=h.tag,gi=h.div,nr=h.span,tr=h.$tag,ir=h.$p,u=h.$div,si=h.$span,rr=h.$a,ur=h.$i,fr=h.$li,er=h.$ul;t.studio={_config:{},start:function(){__settings.appStudio&&(t.id=__settings.appStudio.self.id);i?c({method:"enableVirtualDevice"}):at(!0);kt()},define:function(n,i,r){var u=t.studio._config[n],f;if(u||(u=t.studio._config[n]={}),arguments.length===2)return u[i];switch(i){case"node":case"inspector":u[i]||(u[i]=[]);Array.isArray(r)?u[i]=u[i].concat(r):u[i].push(r);break;default:if(u[i]||(u[i]={}),typeof r=="object")for(f in r)u[i][f]=r;else u[i]=r}return u},toSelector:function(i,r){var v,u={type:r.type},a=r.collect,h=["type"],o,f,c,e,s,y,l;for(o in a)h.push(o);for(o in a)f=a[o],typeof f=="string"&&(f.match(/^\$/)?u[o]=f:(f=f.split(/\//),c=i,f.length===2?(c=i.closest(f[0]),u[o]=f[1].match(/^@/)?c.attr(f[1].substring(1)):c.find(f[1]).text()):u[o]=f[0].match(/^@/)?c.attr(f[0].substring(1)):c.closest(f[0]).text()));"dataView"in u&&(e=u.dataView,e==="$dataView"?(s=i.closest(".app-echo").attr("data-for"),s||(s=i.closest(".ui-page").attr("id")),s==="Main"&&(s=i.closest(".app-echo").attr("data-for")),e=t.find(s),e&&e._controller&&e._viewId||(s=null,e=null),u.dataView=s):e=t.find(u.dataView),e&&(h.splice(h.indexOf("dataView")+1,0,"controller","view"),u.controller=e._controller,u.view=e._viewId,y=n.pageInfo(e),(y&&y.home||i.closest("#Main.ui-page").length)&&(h.splice(h.indexOf("dataView"),0,"page"),l=location.pathname.split(/\//g),u.page=l[l.length-1])));"page"in u&&u.page==="$page"&&(l=location.pathname.split(/\//g),u.page=l[l.length-1]);for(o in a)f=a[o],typeof f=="function"&&(u[o]=f.call(u,i));return v={},r.property&&(u.property=r.property,h.push("property")),h.forEach(function(n){v[n]=u[n]}),v},config:function(n){var i,t;for(var r in this._config)if(t=this._config[r],t.when&&t.when()){i=t[n];break}return i},inspect:function(i,r){l.css("left",-1e4);var u=$(document.elementFromPoint(i,r)),e,f,o,s=t.studio.config("inspector");s?(l.css("left",""),s.every(function(n){var r,s,i;try{if(r=u.closest(n.test),r.length&&(!n.skip||!u.closest(n.skip).length)&&(u=r,e=n,o=n.navigate,f=t.studio.toSelector(u,n),n.require))for(s in n.require)if(i=n.require[s],(typeof i=="function"&&i.call(f,u)||i)&&f[s]==null){e=null;f=null;o=null;break}}catch(h){console.log(`${h.message} in "${n.test}"`)}return!e}),this.explore({elem:u,selector:f,navigate:o})):n.notify("Inspector configuration is not available.")},explore:function(n){var r=n.elem,i=r[0].getBoundingClientRect();v({method:"explore",selector:n.selector,bounds:{left:i.left,top:i.top,width:i.width,height:i.height},navigate:t.eval(n.navigate,n.selector)})},menu:function(){return[{title:"Home",url:"/pages/home",description:"Application home page",selected:!0,cssClass:"Wide"}]},getScript:function(i,r){return typeof i!="string"&&(r=i,i=r.url),r||(r={}),i.match(/^~\//)&&(i=n.studio()+"/"+i.substring(2)),ft?(r.manifest=ft,t.getScript(i,r)):new Promise((u,f)=>{fetch(n.studio()+"/manifest.json",{cache:"no-store"}).then(n=>n.text()).then(e=>{ft=JSON.parse(e);var o=n.studio();ft.offline_resources.forEach(n=>{n.src=o+"/"+n.src});t.studio.getScript(i,r).then(()=>{u()}).catch(n=>{f(n)})}).catch(n=>{f(n)})})}};$(document).on("vclick",".studio #studio .ui-content",function(){n.notify(!1);a?c({method:"inspect",at:n.lastTouch()}):p()}).one("start.app",function(){if($("body.studio").length){i=!0;a=n.startUrl().match(/inspect=true/);g=si("studio-selector").appendTo("#studio").hide();c({method:"started"});a&&(e.addClass("studio-inspecting"),n.notify({text:"Click or tap anywhere in the app to inspect. Press 'Esc' to end the inspection mode.",duration:"long"}));$(document).on("keydown",ci);t.studio.start()}}).one("pagereadycomplete.app",function(){var t,r,n;if(i){at(!i);t=$(parent.window.document).find(".ui-page-active .app-wrapper");r=t.scrollTop();$(".ui-page-active .app-vscrollbar").css("display","none");gt();n=$(".ui-page-active .app-wrapper");u("studio-scroller").css({height:wt+n.height()}).appendTo(n);n.scrollTop(r).data("scrollTop",r).on("scroll",function(){var i=n.scrollTop();i!==n.data("scrollTop")&&(tt(),t.scrollTop(i),n.data("scrollTop",i))})}}).on("pagereadycomplete.app",()=>{i&&!location.hash&&f(":active")&&pt()}).on("resized.app",function(){i&&gt();yt()}).on("context.app",function(n){if(i){if(!location.hash){var t=i&&a;n.context.push({studio:!0,text:"Apps",icon:"material-icon-apps",context:{action:"apps"},callback:s},{studio:!0},{studio:!0,text:t?"End Inspection":"Inspect",icon:t?"material-icon-arrow-selector-tool":"material-icon-point-scan",context:{action:t?"inspect-end":"inspect-start"},callback:s},{studio:!0,text:"Settings",icon:"material-icon-settings",context:{action:"settings"},callback:s},{studio:!0,text:"Models",icon:"material-icon-account-tree",context:{action:"models"},callback:s},{studio:!0,text:"Pages",icon:"material-icon-menu-book",context:{action:"pages"},callback:s},{studio:!0},{studio:!0,text:"Develop",icon:"material-icon-webhook",context:{action:"develop"},callback:s},{studio:!0,text:"Show Source Code",icon:"material-icon-folder-open",context:{action:"open"},callback:s},{studio:!0,text:"Sync Design",icon:"material-icon-sync",context:{action:"sync"},callback:s},{studio:!0,text:"Publish",icon:"material-icon-publish",context:{action:"publish"},callback:s},{studio:!0},{studio:!0,text:"Design",icon:"material-icon-build",context:{action:"explore"},callback:s});n.context.push({studio:!0,text:"Form Template",context:{action:"form-template"},icon:"material-icon-screenshot",callback:s},{studio:!0});$('[data-studio-action="rotate"]').is(".studio-btn-hidden")||n.context.push({studio:!0,text:"Rotate",icon:"material-icon-screen-rotation-alt",context:{action:"rotate"},callback:s});n.context.push(oi)}}else r.isVirtual||n.context.push({},ei)}).on("vclick",".studio-app-shield",()=>{if(!f(":log"))return ki(),!1}).on("execstudiotrigger.app",()=>{f().trigger("vclick")}).on("vclick","[data-studio-action]",n=>{var t=$(n.target).closest("[data-studio-action]");return t.addClass("app-active"),setTimeout(()=>{t.removeClass("app-active")},96),setTimeout(s,64,{target:t,action:t.attr("data-studio-action")}),!1}).on("studioactioninspectend.app",()=>(p(),!1)).on("studioactioninspectstart.app",()=>(y({inspect:!0}),!1)).on("studioactionexit.app",()=>(et(),!1)).on("studioactionmore.app",()=>{if(i){if(n.showContextMenu(),!a)$(document).one("panelclosed.app",n=>{n.canceled&&p()})}else y({event:{type:"studioactionmore.app"}});return!1}).on("studioactionsettings.app",()=>(i?w().then(()=>{$app.touch.propGrid("show",{instance:"studio.settings",text:"Settings",icon:"material-icon-settings",nodes:ht(`/v2/studio/hierarchies/settings/definition`),helpUrl:"https://codeontime.com/roadmap/v9",location:"left"}),st("settings")}).catch(n=>k(n)):y({event:{type:"studioactionsettings.app"}}),!1)).on("studioactionexplore.app",()=>(i?w().then(()=>{$app.touch.propGrid("show",{instance:"studio.explore",text:"Project Explorer",icon:"material-icon-build",nodes:ht(`/v2/studio/hierarchies/controllers/definition`),helpUrl:"https://codeontime.com/roadmap/v9",location:"right"}),st("explore")}).catch(n=>k(n)):y({event:{type:"studioactionexplore.app"}}),!1)).on("studioactionmodels.app",()=>(i?w().then(()=>{$app.touch.propGrid("show",{instance:"studio.models",text:"Model Builder",icon:"material-icon-account-tree",nodes:ht(`/v2/studio/hierarchies/models/definition`),helpUrl:"https://codeontime.com/roadmap/v9",location:"left"}),st("models")}).catch(n=>k(n)):y({event:{type:"studioactionmodels.app"}}),!1)).on("studioactionformtemplate.app",n=>{var t;if(i)n.notify?$app.touch.notify(n.notify):c({method:"trigger",event:{type:"studioactionformtemplate.app"}});else if(t=$app.touch.dataView(),t&&t.get_isForm()){var e=t._survey,f=t._controller,u="";e&&e.layout?(f=f.replace(/__search/,"._search"),u+=String.format("<!--\r\n\t~/js/surveys/{0}.html\r\n-->\r\n{1}",f,e.layout)):(f+="."+t._viewId,u+="\r\n<!--  "+$app.touch.toWidth(r.width)+" -->\r\n",u+=$app.touch.generateLayout(t,r.width),u+="\r\n",u=String.format("<!--\r\n\t~/views/{0}.html\r\n-->\r\n{1}",f,u.replace(/<span\s+class=\"app-control-inner\">([\s\S]+?)<\/span>/g,"$1").replace(/\n\s*>/g,">")));$app.saveFile(f+".html.txt",u)}else v({method:"trigger",event:{type:"studioactionformtemplate.app",data:{notify:"The top-level view is not a form."}}});return!1}).on("studioonstartdisabled.app",()=>(et(),!1)).on("studioactiondevice.app",r=>{if(i){var f=$('[data-studio-action="device"]').addClass("app-selected"),e=t.clientRect(f),u=[];if(bt.forEach((n,t)=>{u.push({text:n.name,context:{device:n,exitStudio:r.exitStudio},icon:hi(n)?"check":null,callback:wi}),t||u.push({text:"RESTful API",callback:s,context:{action:"restful"}},{})}),n.listPopup({anchor:f,arrow:!1,x:e.left,y:e.top,items:u,fullscreen:!0}),!a)$(document).one("popupclosed.app",n=>{n.canceled&&!a&&p()})}else y({event:{type:"studioactiondevice.app",data:{exitStudio:!0}}});return!1}).on("studiofeature.app",()=>{var i=b[b._last],r="",n,t;return i&&(n=b[b._last].url,t=i.url.match(/id\.(\w+)$/),t&&(r="#"+t[1])),n="https://codeontime.com/roadmap/v9"+r,window.open(n,"_blank"),!1}).on("studioactionsync.app",n=>(i?t.touch.show({text:"Sync Design",text2:"App Studio",topics:[{wrap:!0,questions:[{text:!1,value:"<b>Integrate changes made by other developers in the project.<\/b><p><\/p>",readOnly:!0,htmlEncode:!1,options:{textStyle:"primary"}},{name:"SchemaChanged",text:!1,items:{style:"CheckBoxList",list:[{value:"SchemaChanged",text:"The database schema has changed recently."}]},options:{mergeWithPrevious:!0}}]}],options:{materialIcon:"sync",modal:{fitContent:!0,max:"xxs",always:!0},contentStub:!1,discardChangesPrompt:!1},submitText:"Synchronize"}).then(n=>{f("log"),w().then(()=>t.studio.tools.sync.run({metadata:!!n.SchemaChanged})).then(it).catch(ot)}).fail(()=>{n.exitOnCancel&&p()}):y({event:{type:"studioactionsync.app",data:{exitOnCancel:!0}}}),!1)).on("studioactionrotate.app",()=>{if(i)c({method:"trigger",event:{type:"studioactionrotate.app"}});else{var n=bi(),t,u;r.width===n.width?(t=n.height,u=n.width):(t=n.width,u=n.height);d({name:n.name,width:t,height:u})}return!1}).on("vclick",".studio-skirt, .app-virtual-screen-bar",()=>(n.notify(!1),i&&tt(),!1));$(window).on("resize",function(){i&&tt()});$(document).on("treeview.app",r=>{var u,f;i&&(u=r.treeView,u.eventName==="iterate"&&(u.result=ii({hypermedia:u.node.iterate,context:u.nodeData}).then(n=>Promise.resolve(n?.collection||[]))),u.eventName==="navigate"&&(r.preventDefault(),f=u.path.match(/^(.+?)\:\/\/(.+)$/),f&&(t.userVar("treeview.studio."+f[1],u.path),n.goBack(()=>{$(document).trigger(`studioaction${f[1]}.app`)}))))}).on("propgrid.app",n=>{if(i)switch(n.propGrid.eventName){case"edit":return vi(n.propGrid,n.treeView),!1;case"help":return li(n.propGrid,n.treeView),!1;case"fetch":n.propGrid.result=Promise.all([yi(n.treeView.node?.type),ii({hypermedia:n.treeView.node?.get,context:n.treeView.nodeData})])}});window.addEventListener("message",function(s){var h=s.data.method,a,y,rt,w,c,ft,ot,st,ht,b,k,tt,it,pt;if(h==="inspect")t.studio.getScript("~/js/studio/inspector.js").then(()=>t.studio.inspect(s.data.at.x,s.data.at.y)).catch(n=>v({method:"notify",message:ct(n)}));else if(h==="explore")a=s.data.bounds,y=s.data.navigate,g.show().css({left:a.left,top:a.top,width:a.width,height:a.height}),rt=!0,y&&(w=y.split(/^(.+?)\:\/\//),w&&(y.match(/^explore/)||(rt=!1),t.userVar("treeview.studio."+w[1],y),$(document).trigger(`studioaction${w[1]}.app`))),pi(rt?s.data.selector:!1);else if(h==="started")e.addClass("studio-mode"),l.css("left",""),n.busy(!1),$(".studio-btn-inspect i").text("point_scan");else if(h==="enableVirtualDevice")r.isVirtual||(c=t.userVar("lastVirtualDevice"),c&&(c.autoRotate=!0),c&&c.width||(c={name:"Responsive",width:"auto",height:"auto"}),d(c)),yt(),vt(),lt(),ut&&(ft=ut.event,ft&&v({method:"trigger",event:ft})),ut=null;else if(h==="hide")if(l&&l.remove(),l=null,e.removeClass("studio-mode"),at(),ot=$(".ui-popup-active,.ui-panel-open").find(".app-has-scrollbars"),ot.length)ot.trigger("focus");else{$(".ui-page-active").trigger("focus");try{st=window.history.state;st&&nt&&st.url!==nt.url&&(window.history.replaceState(nt,null),nt=null)}catch(wt){}}else h==="exit"?i?p():et():h==="trigger"?(ht=$.Event(s.data.event.type,s.data.event.data),$(this.document).trigger(ht)):h==="notify"?n.notify(s.data.message):h==="reload"?location.replace(location.pathname):h==="changeDevice"?(d(s.data.device),s.data.exitStudio&&v({method:"exit"})):h==="virtualDeviceChanged"?($('[data-studio-action="device"] .studio-btn-label').html(s.data.options.text),o=s.data.options.screen,b=$(".studio-skirt-top"),b.length||(b=u("studio-skirt studio-skirt-top").appendTo(e)),b.css({left:0,top:0,height:o.top,right:0}),k=$(".studio-skirt-bottom"),k.length||(k=u("studio-skirt studio-skirt-bottom").appendTo(e)),k.css({left:0,bottom:0,height:o.bottom,right:0}),tt=$(".studio-skirt-left"),tt.length||(tt=u("studio-skirt studio-skirt-left").appendTo(e)),tt.css({left:0,bottom:0,width:o.left,top:0}),it=$(".studio-skirt-right"),it.length||(it=u("studio-skirt studio-skirt-right").appendTo(e)),it.css({right:0,bottom:0,width:o.right,top:0}),f("reposition"),$(".studio-inspection-result").hide()):h==="studioToolsChanged"?$('[data-studio-action="rotate"]').toggleClass("studio-btn-hidden",!s.data.tools.rotate):h==="alterUI"?(pt=s.data,i||s.data.scripts.forEach(n=>{try{t.eval(n,s.data.context)}catch(i){v({method:"notify",message:i.message})}})):h=="shield"&&i&&f(s.data.args.method,s.data.args.options)});i||n.activePage().length||(t.studio._started=!1);t.studio.shield=f;t.studio.state=function(n){if(arguments.length)n==null?localStorage.removeItem("studio.state"):localStorage.setItem("studio.state",JSON.stringify(n));else return n=localStorage.getItem("studio.state"),n!=null?JSON.parse(n):{}};$(document).on("invokegetpage.app",i=>{var f=i.invoke.params.controller.match(/^data\:application\/json\;base64\s(.+?)$/),u,r;if(f)return u=n.dataView()._survey.context.target,u._context=n.propGrid.data,r=JSON.parse(atob(f[1])),r.hypermedia&&(r.hypermedia.match(/\$\{/)&&(r.hypermedia=t.eval(r.hypermedia,u)),r.hypermedia=`projects >> ${t.id} >> ${r.hypermedia}`),r?.query?.filter&&(r.query.filter=t.eval(r.query.filter,u)),delete u._context,r.cache=!0,rt(r).then(n=>{r.processor&&t.eval(r.processor,n);var u=t.studio.utils.resourceToViewPage(n);i.invoke.params.controller=u.Controller;i.invoke.success(u)}).catch(k),!1}).on("invokegetpagelist.app",()=>{}).on("pointerdown mousedown touchstart","[data-studio-link]",function(){var n=$(this).attr("data-studio-link");if(n&&n.match(/^http/))return window.open(n,"_blank"),!1})})()